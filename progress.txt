# Build Progress Log

## Task 1 - 2026-02-21
### Completed: Migrate to Dynamic v2/v3 Base URL

**What was implemented:**
- Changed `defaultBaseURL` from `https://api.clickup.com/api/v2` to `https://api.clickup.com/api` in both `api/client.go` and `clickup/client.go`
- Updated ALL existing service method paths to include `/v2/` prefix (e.g., `/task/{id}` → `/v2/task/{id}`)
- Added `workspaceID` field to `clickup.Client` struct
- Added `ClientOption` functional options pattern for configuring the client
- Added `WithWorkspaceID` option for future v3 endpoint support
- Added `v3Path()` helper method to build v3 API paths with workspace ID prefix
- Added `Patch()` method to `api.Client` for v3 PATCH endpoints
- Added `PostMultipart()` method to `api.Client` for file upload endpoints
- Added comprehensive tests for all new functionality:
  - `TestV3Path_BuildsCorrectPath` - verifies v3 path construction
  - `TestV3Path_MissingWorkspaceID` - verifies error handling for missing workspace ID
  - `TestPatch_SendsJSONBody` - verifies PATCH method sends correct HTTP method and body
  - `TestPatch_PropagatesAPIError` - verifies PATCH error handling
  - `TestPostMultipart_SendsFile` - verifies multipart file upload
  - `TestPostMultipart_SetsAuthHeader` - verifies auth header is set
  - `TestPostMultipart_PropagatesAPIError` - verifies multipart error handling
  - `TestBaseURLConstruction` - verifies new base URL structure

**Files changed:**
- `internal/api/client.go` — modified (base URL, Patch, PostMultipart methods)
- `internal/api/client_test.go` — modified (added tests for Patch, PostMultipart, base URL)
- `internal/clickup/client.go` — modified (base URL, workspaceID, v3Path helper, all paths with /v2/)
- `internal/clickup/client_test.go` — modified (v3Path tests, updated path expectations)
- `internal/clickup/types.go` — minor formatting fixes from linter

**Branch:** `phase/1-foundation`
**Commit:** `086de16`

**Learnings for future iterations:**
- The linter (wsl_v5) requires blank lines before return statements after if/else blocks
- Variable shadowing (`err`) triggers govet shadow check - use different variable names
- The `make ci` target runs `fmt-check` which checks for uncommitted changes - must commit before passing
- Functional options pattern is the idiomatic way to configure clients in Go

---

## Task 2 - 2026-02-21
### Completed: Add Workspace ID Configuration

**What was implemented:**
- Added `--workspace` global flag to CLI root command with help text explaining it's required for v3 API
- Added `CLICKUP_WORKSPACE_ID` environment variable support via Kong vars binding
- Added workspace ID to config file (`config.json`) with `GetWorkspaceID()` and `SetWorkspaceID()` functions
- Updated `getClickUpClient()` to resolve workspace ID from: context (flag) > env var > config
- Added `withWorkspaceID()` and `getWorkspaceIDFromContext()` helpers to pass workspace ID via context
- Added `auth set-workspace` command to configure workspace ID
- Updated `auth status` command to display workspace ID configuration status
- Workspace ID is passed to the ClickUp client via `WithWorkspaceID()` option (implemented in Task 1)

**Files changed:**
- `internal/cmd/root.go` — modified (added Workspace flag, workspace context helpers, kong vars)
- `internal/cmd/helpers.go` — modified (getClickUpClient now takes context, resolves workspace ID)
- `internal/cmd/auth.go` — modified (added AuthSetWorkspaceCmd, updated AuthStatusCmd)
- `internal/config/config.go` — modified (added WorkspaceID to configData, GetWorkspaceID, SetWorkspaceID)
- All command files (tasks.go, comments.go, members.go, lists.go, time.go, spaces.go) — updated to pass context to getClickUpClient

**Branch:** `phase/1-foundation`

**Learnings for future iterations:**
- When adding global flags to Kong CLI, do NOT embed RootFlags in subcommands - it creates duplicate flags
- Use context to pass global flag values down to helper functions instead of adding fields to every command struct
- The Kong vars mechanism allows environment variable defaults for flags via `${varname}` syntax in default tag
- Workspace ID is optional for v2 endpoints - only v3 endpoints require it (error handled in v3Path helper from Task 1)

---

## Task 3 - 2026-02-21
### Completed: Add Contract Tests for v3 Infrastructure

**What was implemented:**
- Contract tests for v3 infrastructure were already implemented as part of Tasks 1 and 2
- Tests verify:
  - `TestBaseURLConstruction` - base URL construction for v2 paths
  - `TestV3Path_BuildsCorrectPath` - v3Path helper builds correct workspace-prefixed paths
  - `TestV3Path_MissingWorkspaceID` - error handling for missing workspace ID
  - `TestPatch_SendsJSONBody` - PATCH method sends correct HTTP method and JSON body
  - `TestPatch_PropagatesAPIError` - PATCH error handling matches existing patterns
  - `TestPostMultipart_SendsFile` - multipart file upload with correct content type
  - `TestPostMultipart_SetsAuthHeader` - auth header set on multipart requests
  - `TestPostMultipart_PropagatesAPIError` - multipart error handling

**Files changed:**
- No new files - tests were already in place from Tasks 1 and 2

**Branch:** `phase/1-foundation`
**PR URL:** (pending - Phase 1 complete, ready for PR creation)

**Learnings for future iterations:**
- When implementing infrastructure changes, include tests as part of the same task for atomic verification
- The spec recommended separate test task, but implementing tests alongside infrastructure is more efficient

---

## Phase 1 Complete

All 3 foundation architecture tasks are complete:
1. ✅ Migrate to Dynamic v2/v3 Base URL
2. ✅ Add Workspace ID Configuration
3. ✅ Add Contract Tests for v3 Infrastructure

Next: Open PR from `phase/1-foundation` to `fix/plain-output`, then start Phase 2 (Workspaces & Authorization)

---

## Task 24 - 2026-02-22
### Completed: Create User Groups Service

**What was implemented:**
- Created `UserGroupsService` with List, Create, Update, Delete methods
- Implemented `GET /v2/group` (list all groups)
- Implemented `POST /v2/team/{team_id}/group` (create group)
- Implemented `PUT /v2/group/{group_id}` (update group)
- Implemented `DELETE /v2/group/{group_id}` (delete group)
- Added UserGroup types: UserGroup, CreateUserGroupRequest, UpdateUserGroupRequest, UserGroupMembersUpdate, UserGroupsResponse
- Added CLI commands: `groups list`, `groups create`, `groups update`, `groups delete`
- Support add/remove members pattern for group updates (same as task assignees pattern)
- Added 6 comprehensive tests for all service methods

**Files changed:**
- `internal/clickup/client.go` — added UserGroups() accessor and UserGroupsService with all methods
- `internal/clickup/types.go` — added all UserGroup types
- `internal/clickup/client_test.go` — added tests for UserGroups service
- `internal/cmd/groups.go` — created with all CLI commands
- `internal/cmd/root.go` — added GroupsCmd to CLI struct

**Branch:** `phase/9-p2-completeness`
**Commit:** `5683ef5`
**PR URL:** https://github.com/Robben-Media/clickup-cli/pull/16

**Learnings:**
- Variable shadowing (`err`) inside if blocks triggers govet shadow check - use different variable names like `parseErr`
- Group IDs are strings (UUIDs) unlike user IDs which are integers
- Update members uses add/rem pattern (same as task assignees)

---

## Task 25 - 2026-02-22
### Completed: Create Roles Service

**What was implemented:**
- Created `RolesService` with List method
- Implemented `GET /v2/team/{team_id}/customroles` (list custom roles)
- Added CustomRole types: CustomRole, CustomRolesResponse
- Added CLI command: `roles list`
- Added 2 comprehensive tests for all service methods

**Files changed:**
- `internal/clickup/client.go` — added Roles() accessor and RolesService with List method
- `internal/clickup/types.go` — added all CustomRole types
- `internal/clickup/client_test.go` — added tests for Roles service
- `internal/cmd/roles.go` — created with CLI command
- `internal/cmd/root.go` — added RolesCmd to CLI struct

**Branch:** `phase/9-p2-completeness`
**Commit:** `7084499`
**PR URL:** https://github.com/Robben-Media/clickup-cli/pull/16

**Learnings:**
- Roles endpoint returns integer IDs (not UUIDs like groups)
- The pattern is consistent with other services: simple service struct, accessor method, types, and tests
- `make ci` includes fmt-check which requires files to be formatted before committing
- All tests pass with new service implementation

---

## Task 26 - 2026-02-22
### Completed: Create Guests Service

**What was implemented:**
- Created `GuestsService` with 10 methods for guest management
- Implemented workspace-level guest CRUD:
  - `GET /v2/team/{team_id}/guest/{guest_id}` (get guest)
  - `POST /v2/team/{team_id}/guest` (invite guest)
  - `PUT /v2/team/{team_id}/guest/{guest_id}` (update guest)
  - `DELETE /v2/team/{team_id}/guest/{guest_id}` (remove guest)
- Implemented guest-to-resource assignments:
  - `POST /v2/task/{task_id}/guest/{guest_id}` (add to task)
  - `DELETE /v2/task/{task_id}/guest/{guest_id}` (remove from task)
  - `POST /v2/list/{list_id}/guest/{guest_id}` (add to list)
  - `DELETE /v2/list/{list_id}/guest/{guest_id}` (remove from list)
  - `POST /v2/folder/{folder_id}/guest/{guest_id}` (add to folder)
  - `DELETE /v2/folder/{folder_id}/guest/{guest_id}` (remove from folder)
- Added Guest types: Guest, GuestResponse, InviteGuestRequest, EditGuestRequest, AddGuestToResourceRequest
- Added CLI commands: `guests get`, `guests invite`, `guests update`, `guests remove`, `guests add-to-task`, `guests remove-from-task`, `guests add-to-list`, `guests remove-from-list`, `guests add-to-folder`, `guests remove-from-folder`
- Added 12 comprehensive tests for all service methods

**Files changed:**
- `internal/clickup/client.go` — added Guests() accessor, errEmailRequired, and GuestsService with all methods
- `internal/clickup/types.go` — added all Guest types
- `internal/clickup/client_test.go` — added tests for Guests service
- `internal/cmd/guests.go` — created with all CLI commands
- `internal/cmd/root.go` — added GuestsCmd to CLI struct

**Branch:** `phase/9-p2-completeness`
**Commit:** `e88f284`
**PR URL:** https://github.com/Robben-Media/clickup-cli/pull/16

**Learnings:**
- Guest IDs are integers (not UUIDs like groups)
- Permission levels for adding guests: read, comment, edit, create
- The err113 linter requires static error variables instead of dynamic errors.New()
- wsl_v5 linter requires blank lines before variable declarations after short statements
- Guests have resource counts (tasks_count, lists_count, folders_count) for tracking access

---
---

## Task 27 - 2026-02-22
### Completed: Create Shared Hierarchy Service

**What was implemented:**
- Created `SharedHierarchyService` with List method
- Implemented `GET /v2/team/{team_id}/shared` (list shared hierarchy)
- Added SharedHierarchy types: SharedHierarchyResponse, SharedResources
- Reused existing TaskRef, ListRef, and FolderRef types
- Added CLI command: `shared list`
- Added 2 comprehensive tests for all service methods

**Files changed:**
- `internal/clickup/client.go` — added SharedHierarchy() accessor and SharedHierarchyService with List method
- `internal/clickup/types.go` — added SharedHierarchyResponse and SharedResources types
- `internal/clickup/client_test.go` — added tests for SharedHierarchy service
- `internal/cmd/shared.go` — created with CLI command
- `internal/cmd/root.go` — added SharedCmd to CLI struct

**Branch:** `phase/9-p2-completeness`
**Commit:** `ef87dfe`
**PR URL:** https://github.com/Robben-Media/clickup-cli/pull/16

**Learnings:**
- Shared hierarchy reuses existing TaskRef, ListRef, FolderRef types (defined earlier in types.go)
- The response structure has a `shared` object containing arrays of tasks, lists, and folders
- Plain output format combines all three resource types with a TYPE column for differentiation
- Human-readable output groups resources by type for clarity

---

## Task 28 - 2026-02-22
### Completed: Create Templates Service

**What was implemented:**
- Created `TemplatesService` with List method
- Implemented `GET /v2/team/{team_id}/taskTemplate` (list task templates)
- Added TaskTemplate types: TaskTemplate, TaskTemplatesResponse
- Added CLI command: `templates list` with optional page parameter
- Added 3 comprehensive tests for all service methods

**Files changed:**
- `internal/clickup/client.go` — added Templates() accessor and TemplatesService with List method
- `internal/clickup/types.go` — added TaskTemplate and TaskTemplatesResponse types
- `internal/clickup/client_test.go` — added tests for Templates service
- `internal/cmd/templates.go` — created with CLI command
- `internal/cmd/root.go` — added TemplatesCmd to CLI struct

**Branch:** `phase/9-p2-completeness`
**Commit:** `c0accfb`
**PR URL:** https://github.com/Robben-Media/clickup-cli/pull/16

**Learnings:**
- Templates endpoint supports pagination via `page` query parameter (0-indexed)
- The endpoint path uses `taskTemplate` (camelCase) rather than `task_template` (snake_case)
- Template IDs appear to be string-based (like groups)

