# Build Progress Log

## Task 1 - 2026-02-21
### Completed: Migrate to Dynamic v2/v3 Base URL

**What was implemented:**
- Changed `defaultBaseURL` from `https://api.clickup.com/api/v2` to `https://api.clickup.com/api` in both `api/client.go` and `clickup/client.go`
- Updated ALL existing service method paths to include `/v2/` prefix (e.g., `/task/{id}` → `/v2/task/{id}`)
- Added `workspaceID` field to `clickup.Client` struct
- Added `ClientOption` functional options pattern for configuring the client
- Added `WithWorkspaceID` option for future v3 endpoint support
- Added `v3Path()` helper method to build v3 API paths with workspace ID prefix
- Added `Patch()` method to `api.Client` for v3 PATCH endpoints
- Added `PostMultipart()` method to `api.Client` for file upload endpoints
- Added comprehensive tests for all new functionality:
  - `TestV3Path_BuildsCorrectPath` - verifies v3 path construction
  - `TestV3Path_MissingWorkspaceID` - verifies error handling for missing workspace ID
  - `TestPatch_SendsJSONBody` - verifies PATCH method sends correct HTTP method and body
  - `TestPatch_PropagatesAPIError` - verifies PATCH error handling
  - `TestPostMultipart_SendsFile` - verifies multipart file upload
  - `TestPostMultipart_SetsAuthHeader` - verifies auth header is set
  - `TestPostMultipart_PropagatesAPIError` - verifies multipart error handling
  - `TestBaseURLConstruction` - verifies new base URL structure

**Files changed:**
- `internal/api/client.go` — modified (base URL, Patch, PostMultipart methods)
- `internal/api/client_test.go` — modified (added tests for Patch, PostMultipart, base URL)
- `internal/clickup/client.go` — modified (base URL, workspaceID, v3Path helper, all paths with /v2/)
- `internal/clickup/client_test.go` — modified (v3Path tests, updated path expectations)
- `internal/clickup/types.go` — minor formatting fixes from linter

**Branch:** `phase/1-foundation`
**Commit:** `086de16`

**Learnings for future iterations:**
- The linter (wsl_v5) requires blank lines before return statements after if/else blocks
- Variable shadowing (`err`) triggers govet shadow check - use different variable names
- The `make ci` target runs `fmt-check` which checks for uncommitted changes - must commit before passing
- Functional options pattern is the idiomatic way to configure clients in Go

---

## Task 2 - 2026-02-21
### Completed: Add Workspace ID Configuration

**What was implemented:**
- Added `--workspace` global flag to CLI root command with help text explaining it's required for v3 API
- Added `CLICKUP_WORKSPACE_ID` environment variable support via Kong vars binding
- Added workspace ID to config file (`config.json`) with `GetWorkspaceID()` and `SetWorkspaceID()` functions
- Updated `getClickUpClient()` to resolve workspace ID from: context (flag) > env var > config
- Added `withWorkspaceID()` and `getWorkspaceIDFromContext()` helpers to pass workspace ID via context
- Added `auth set-workspace` command to configure workspace ID
- Updated `auth status` command to display workspace ID configuration status
- Workspace ID is passed to the ClickUp client via `WithWorkspaceID()` option (implemented in Task 1)

**Files changed:**
- `internal/cmd/root.go` — modified (added Workspace flag, workspace context helpers, kong vars)
- `internal/cmd/helpers.go` — modified (getClickUpClient now takes context, resolves workspace ID)
- `internal/cmd/auth.go` — modified (added AuthSetWorkspaceCmd, updated AuthStatusCmd)
- `internal/config/config.go` — modified (added WorkspaceID to configData, GetWorkspaceID, SetWorkspaceID)
- All command files (tasks.go, comments.go, members.go, lists.go, time.go, spaces.go) — updated to pass context to getClickUpClient

**Branch:** `phase/1-foundation`

**Learnings for future iterations:**
- When adding global flags to Kong CLI, do NOT embed RootFlags in subcommands - it creates duplicate flags
- Use context to pass global flag values down to helper functions instead of adding fields to every command struct
- The Kong vars mechanism allows environment variable defaults for flags via `${varname}` syntax in default tag
- Workspace ID is optional for v2 endpoints - only v3 endpoints require it (error handled in v3Path helper from Task 1)

---

## Task 3 - 2026-02-21
### Completed: Add Contract Tests for v3 Infrastructure

**What was implemented:**
- Contract tests for v3 infrastructure were already implemented as part of Tasks 1 and 2
- Tests verify:
  - `TestBaseURLConstruction` - base URL construction for v2 paths
  - `TestV3Path_BuildsCorrectPath` - v3Path helper builds correct workspace-prefixed paths
  - `TestV3Path_MissingWorkspaceID` - error handling for missing workspace ID
  - `TestPatch_SendsJSONBody` - PATCH method sends correct HTTP method and JSON body
  - `TestPatch_PropagatesAPIError` - PATCH error handling matches existing patterns
  - `TestPostMultipart_SendsFile` - multipart file upload with correct content type
  - `TestPostMultipart_SetsAuthHeader` - auth header set on multipart requests
  - `TestPostMultipart_PropagatesAPIError` - multipart error handling

**Files changed:**
- No new files - tests were already in place from Tasks 1 and 2

**Branch:** `phase/1-foundation`
**PR URL:** (pending - Phase 1 complete, ready for PR creation)

**Learnings for future iterations:**
- When implementing infrastructure changes, include tests as part of the same task for atomic verification
- The spec recommended separate test task, but implementing tests alongside infrastructure is more efficient

---

## Phase 1 Complete

All 3 foundation architecture tasks are complete:
1. ✅ Migrate to Dynamic v2/v3 Base URL
2. ✅ Add Workspace ID Configuration
3. ✅ Add Contract Tests for v3 Infrastructure

Next: Open PR from `phase/1-foundation` to `fix/plain-output`, then start Phase 2 (Workspaces & Authorization)

---

## Task 12 - 2026-02-22
### Completed: Create Tags Service

**What was implemented:**
- Created `TagsService` with List, Create, Update, Delete, AddToTask, RemoveFromTask methods
- Implemented `GET /v2/space/{space_id}/tag` - list tags in a space
- Implemented `POST /v2/space/{space_id}/tag` - create a new tag
- Implemented `PUT /v2/space/{space_id}/tag/{tag_name}` - update a tag
- Implemented `DELETE /v2/space/{space_id}/tag/{tag_name}` - delete a tag
- Implemented `POST /v2/task/{task_id}/tag/{tag_name}` - add tag to task
- Implemented `DELETE /v2/task/{task_id}/tag/{tag_name}` - remove tag from task
- Added types: `SpaceTag`, `SpaceTagsResponse`, `CreateSpaceTagRequest`, `EditSpaceTagRequest`
- Added CLI commands:
  - `tags list --space <space_id>` - list tags in a space
  - `tags create <space_id> <name> [--bg <color>] [--fg <color>]` - create tag
  - `tags update <space_id> <name> [--new-name] [--bg] [--fg]` - update tag
  - `tags delete <space_id> <name>` - delete tag
  - `tags add <task_id> <tag_name>` - add tag to task
  - `tags remove <task_id> <tag_name>` - remove tag from task
- Added comprehensive tests:
  - `TestTagsList_ReturnsSpaceTags` - verifies list response parsing
  - `TestTagsList_RequiresSpaceID` - validates space ID requirement
  - `TestTagsCreate_SendsTagEnvelope` - verifies create with `{"tag": {...}}` envelope
  - `TestTagsCreate_RequiresSpaceID` - validates space ID requirement
  - `TestTagsCreate_RequiresName` - validates name requirement
  - `TestTagsUpdate_SendsPutRequest` - verifies update request
  - `TestTagsUpdate_RequiresSpaceID` - validates space ID requirement
  - `TestTagsUpdate_RequiresTagName` - validates tag name requirement
  - `TestTagsDelete_SendsDeleteRequest` - verifies delete request
  - `TestTagsDelete_RequiresSpaceID` - validates space ID requirement
  - `TestTagsDelete_RequiresTagName` - validates tag name requirement
  - `TestTagsAddToTask_SendsPostRequest` - verifies add to task
  - `TestTagsAddToTask_EscapesTagName` - verifies URL encoding for spaces
  - `TestTagsAddToTask_RequiresTaskID` - validates task ID requirement
  - `TestTagsAddToTask_RequiresTagName` - validates tag name requirement
  - `TestTagsRemoveFromTask_SendsDeleteRequest` - verifies remove from task
  - `TestTagsRemoveFromTask_RequiresTaskID` - validates task ID requirement
  - `TestTagsRemoveFromTask_RequiresTagName` - validates tag name requirement

**Files changed:**
- `internal/clickup/client.go` — modified (added TagsService with 6 methods)
- `internal/clickup/types.go` — modified (added SpaceTag, SpaceTagsResponse, CreateSpaceTagRequest, EditSpaceTagRequest)
- `internal/clickup/client_test.go` — modified (added 18 tests)
- `internal/cmd/tags.go` — created (CLI commands for all tag operations)
- `internal/cmd/root.go` — modified (added TagsCmd to CLI struct)

**Branch:** `phase/5-task-extensions`
**Commit:** `8ad640e`
**PR URL:** https://github.com/Robben-Media/clickup-cli/pull/12

**Learnings for future iterations:**
- Use `r.RequestURI` in tests to check URL-encoded paths; `r.URL.Path` is decoded by Go's http server
- Tag names in ClickUp API are URL-encoded in the path, not sent as IDs
- Create/Edit operations wrap the tag in a `{"tag": {...}}` envelope

**Next:** Task 13 - Create Checklists Service - Phase 5 Task Extensions

---

## Task 13 - 2026-02-22
### Completed: Create Checklists Service

**What was implemented:**
- Created `ChecklistsService` with Create, Update, Delete, AddItem, UpdateItem, DeleteItem methods
- Implemented `POST /v2/task/{task_id}/checklist` - create checklist on task
- Implemented `PUT /v2/checklist/{checklist_id}` - update checklist (name, position)
- Implemented `DELETE /v2/checklist/{checklist_id}` - delete checklist
- Implemented `POST /v2/checklist/{checklist_id}/checklist_item` - add item to checklist
- Implemented `PUT /v2/checklist/{checklist_id}/checklist_item/{item_id}` - update checklist item
- Implemented `DELETE /v2/checklist/{checklist_id}/checklist_item/{item_id}` - delete checklist item
- Added types: `Checklist`, `ChecklistItem`, `CreateChecklistRequest`, `EditChecklistRequest`, `CreateChecklistItemRequest`, `EditChecklistItemRequest`
- Added CLI commands:
  - `checklists create --task <task_id> <name>` - create checklist on task
  - `checklists update <checklist_id> [--name "..."] [--position <n>]` - update checklist
  - `checklists delete <checklist_id>` - delete checklist
  - `checklists add-item <checklist_id> <name> [--assignee <user_id>]` - add item
  - `checklists update-item <checklist_id> <item_id> [--name "..."] [--resolved|--unresolved] [--assignee <user_id>] [--parent <item_id>]` - update item
  - `checklists delete-item <checklist_id> <item_id>` - delete item
- Added comprehensive tests for all 6 service methods (18 test cases total)

**Files changed:**
- `internal/clickup/client.go` — modified (added ChecklistsService with 6 methods)
- `internal/clickup/types.go` — modified (added Checklist, ChecklistItem, request types)
- `internal/clickup/client_test.go` — modified (added 18 tests)
- `internal/cmd/checklists.go` — created (CLI commands for all checklist operations)
- `internal/cmd/root.go` — modified (added ChecklistsCmd to CLI struct)

**Branch:** `phase/5-task-extensions`
**Commit:** `c8b3d89`

**Learnings for future iterations:**
- ClickUp wraps checklist responses in `{"checklist": {...}}` envelope - need to unwrap in service layer
- `resolved` field is boolean, use pointer type in request to allow true/false/unset distinction
- Use `--resolved` and `--unresolved` flags to avoid ambiguity with boolean flag defaults
- Linter (wsl_v5) requires blank lines between statements before if blocks

**Next:** Task 14 - Create Relationships Service - Phase 5 Task Extensions

---

## Task 14 - 2026-02-22
### Completed: Create Relationships Service

**What was implemented:**
- Created `RelationshipsService` with AddDependency, RemoveDependency, Link, Unlink methods
- Implemented `POST /v2/task/{task_id}/dependency` - add task dependency (depends_on or dependency_of)
- Implemented `DELETE /v2/task/{task_id}/dependency` - remove task dependency (query params)
- Implemented `POST /v2/task/{task_id}/link/{link_task_id}` - add link between tasks
- Implemented `DELETE /v2/task/{task_id}/link/{link_task_id}` - remove link between tasks
- Added types: `AddDependencyRequest`
- Added static errors: `errDependsOnRequired`, `errLinkTaskIDRequired`
- Added CLI commands:
  - `relationships add-dep <task_id> --depends-on <task>` or `--blocking <task>` - add dependency
  - `relationships remove-dep <task_id> --depends-on <task>` or `--blocking <task>` - remove dependency
  - `relationships link <task_id> <linked_task_id>` - link tasks
  - `relationships unlink <task_id> <linked_task_id>` - unlink tasks
- Added comprehensive tests for all 4 service methods (12 test cases total)

**Files changed:**
- `internal/clickup/client.go` — modified (added RelationshipsService with 4 methods, static errors)
- `internal/clickup/types.go` — modified (added AddDependencyRequest)
- `internal/clickup/client_test.go` — modified (added 12 tests)
- `internal/cmd/relationships.go` — created (CLI commands for all relationship operations)
- `internal/cmd/root.go` — modified (added RelationshipsCmd to CLI struct)

**Branch:** `phase/5-task-extensions`
**Commit:** `ced2b44`

**Learnings for future iterations:**
- Use static errors at package level instead of inline `errors.New()` - linter (err113) requires this
- Delete dependency uses query params, not request body
- `--blocking` flag is clearer than `--dependency-of` for CLI users
- Use wrapped static errors for better error handling

**Next:** Task 15 - Create Custom Fields Service - Phase 5 Task Extensions

---

## Task 15 - 2026-02-22
### Completed: Create Custom Fields Service

**What was implemented:**
- Created `CustomFieldsService` with ListByList, ListByFolder, ListBySpace, ListByTeam, Set, Remove methods
- Implemented `GET /v2/list/{list_id}/field` - list fields accessible from list
- Implemented `GET /v2/folder/{folder_id}/field` - list fields accessible from folder
- Implemented `GET /v2/space/{space_id}/field` - list fields accessible from space
- Implemented `GET /v2/team/{team_id}/field` - list fields accessible from workspace
- Implemented `POST /v2/task/{task_id}/field/{field_id}` - set custom field value
- Implemented `DELETE /v2/task/{task_id}/field/{field_id}` - remove custom field value
- Added types: `CustomField`, `CustomFieldsResponse`, `SetCustomFieldRequest`
- Added static error: `errFieldIDRequired`
- Added CLI commands:
  - `fields list --list <id>` or `--folder <id>` or `--space <id>` or `--team <id>` - list custom fields
  - `fields set --task <task_id> --field <field_id> --value <value>` - set field value
  - `fields remove --task <task_id> --field <field_id>` - remove field value
- Added comprehensive tests for all 6 service methods (14 test cases total)

**Files changed:**
- `internal/clickup/client.go` — modified (added CustomFieldsService with 6 methods, static error)
- `internal/clickup/types.go` — modified (added CustomField, CustomFieldsResponse, SetCustomFieldRequest)
- `internal/clickup/client_test.go` — modified (added 14 tests)
- `internal/cmd/fields.go` — created (CLI commands for all custom field operations)
- `internal/cmd/root.go` — modified (added FieldsCmd to CLI struct)

**Branch:** `phase/5-task-extensions`
**Commit:** `32ca994`

**Learnings for future iterations:**
- Custom field values can be any type (string, number, object, array) - use `interface{}`
- CLI accepts JSON strings for complex values, parsing them before sending to API
- List commands require exactly one scope flag - validate in CLI layer
- Response format is `{"fields": [...]}` envelope

---

## Phase 5 Complete

All 4 task extension tasks are complete:
1. ✅ Task 12: Create Tags Service
2. ✅ Task 13: Create Checklists Service
3. ✅ Task 14: Create Relationships Service
4. ✅ Task 15: Create Custom Fields Service

Phase 5 adds 22 endpoints for task-level operations.

**Next:** Phase 6 - Views, Webhooks, Goals (P1) - Tasks 16-18
